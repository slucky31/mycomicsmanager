@page "/comics/Import"

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-4">

    <MudText Typo="Typo.h4">Import</MudText>

    <MudAlert Class="my-4" Severity="Severity.Warning">Max allowed files: @MaxAllowedFiles</MudAlert>

    <style>

        .drag-drop-zone {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            position: relative;
        }

            .drag-drop-zone:hover {
                background-color: #f5f5f5;
            }

            .drag-drop-zone input[type=file] {
                position: absolute;
                width: 100%;
                height: 100%;
                opacity: 0;
                cursor: pointer;
            }

        .drag-enter {
            box-shadow: var(--mud-elevation-10);
        }

        .list {
            padding: 2em;
            min-width: 100%;
        }
    </style>

    <MudPaper @ondragenter="@(()=>DragEnterStyle="drag-enter")"
              @ondragleave="@(()=>DragEnterStyle=null)"
              @ondragend="@(()=>DragEnterStyle=null)"
              Class=@("drag-drop-zone "+ DragEnterStyle)>

        <InputFile OnChange="OnInputFileChanged" multiple accept="@(GetAllowedExtensions())" />

        @if (BrowserFiles.Count() == 0)
        {
            <MudAlert Class="my-4" Severity="Severity.Info">Glisser-Déposer vos fichiers ici ou cliquer pour ouvrir la fenêtre de téléchargement !</MudAlert>
        }
        else
        {
            <MudList Style="padding:2em;width:100%;" Dense="true">
                @foreach (var file in BrowserFiles)
                {
                    <MudListItem @key="@file.Name">
                        <MudChip Color="Color.Dark"
                                 Style="width:60px; overflow:hidden;"
                                 Text="@(file.Name.Split(".").Last())" />
                        @file.Name
                    </MudListItem>}
            </MudList>
        }
    </MudPaper>

    <MudGrid Class="my-2" Justify="Justify.Center" Spacing="4">
        <MudItem>
            <MudButton OnClick="UploadFiles" Disabled="@(!BrowserFiles.Any())" Color="Color.Primary" Variant="Variant.Filled">Upload</MudButton>
        </MudItem>
        <MudItem>
            <MudButton OnClick="@BrowserFiles.Clear" Disabled="@(!BrowserFiles.Any())" Color="Color.Error" Variant="Variant.Filled">Clear</MudButton>
        </MudItem>
    </MudGrid>
    
    @if ((UploadedFiles.Count() != 0) || Uploading)
    {
        <MudText Typo="Typo.h5">Comics uploadés</MudText>
        <MudTable Items="UploadedFiles" Hover="true" Breakpoint="Breakpoint.Sm" Loading="@Uploading" LoadingProgressColor="Color.Info">
            <HeaderContent>
                <MudTh>Fichier</MudTh>
                <MudTh>Taille</MudTh>
                <MudTh>Temps Upload</MudTh>
                <MudTh>Exception Message</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Fichier">@context.Name</MudTd>
                <MudTd DataLabel="Taille">@context.Size</MudTd>
                <MudTd DataLabel="Temps Upload">@context.UploadDuration</MudTd>
                <MudTd DataLabel="Exception Message">@context.ExceptionMessage</MudTd>
            </RowTemplate>

        </MudTable>
    }

    @if (ImportingFiles.Count() != 0)
    {
        <MudText Class="my-4" Typo="Typo.h5">Comics en attente de traitement</MudText>
        <MudTable Items="ImportingFiles" Hover="true" Breakpoint="Breakpoint.Sm" Loading="@Uploading" LoadingProgressColor="Color.Info">
            <HeaderContent>
                <MudTh>Fichier</MudTh>
                <MudTh>Taille</MudTh>
                <MudTh>Actions</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Fichier">@context.Name</MudTd>
                <MudTd DataLabel="Taille">@context.Size</MudTd>
                <MudTd DataLabel="Actions"><MudIconButton Icon="@Icons.Material.Filled.ThumbUp" /></MudTd>
            </RowTemplate>
            <FooterContent>
                <MudTd colspan="3"><MudButton HtmlTag="label" Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Filled.Add" OnClick="@(async () => await AddComics())">ADD ALL</MudButton></MudTd>
            </FooterContent>
        </MudTable>
    }
</MudContainer>
