@using Domain.Books
@using Web.Enum
@using Web.Validators

@rendermode InteractiveServer

@page "/books/list"

<style>
    .green-left-border {
        border-left: 4px solid #4caf50; /* Material Green 500 */
    }
    
    .book-image {
        width: 60px;
        height: 80px;
        object-fit: cover;
        border-radius: 4px;
    }
</style>

<PageWithAction Title="Books" Icon="@Icons.Material.Filled.MenuBook" ActionName="New book" ActionIcon="@Icons.Material.Filled.Add" OnActionClick="@(e => CreateOrEdit(FormMode.Create, null))">
    <MudGrid Spacing="4" Justify="Justify.FlexStart">
        @foreach (var book in Books)
        {
            <MudItem xs="12" sm="6" md="4" lg="3">
                <MudCard Class="green-left-border" Outlined="true">
                    <MudCardHeader>
                        <CardHeaderContent>
                            <MudText Typo="Typo.h6">@book.Title</MudText>
                            @if (!string.IsNullOrEmpty(book.Serie))
                            {
                                <MudText Typo="Typo.body2" Color="Color.Secondary">@book.Serie</MudText>
                            }
                        </CardHeaderContent>
                        <CardHeaderActions>
                            <MudMenu Icon="@Icons.Material.Filled.MoreVert" AriaLabel="Actions">
                                <MudMenuItem Label="Edit" OnClick="@(e => CreateOrEdit(FormMode.Edit, @book))" />
                                <MudMenuItem Label="Delete" OnClick="@(e => Delete(@book.Id))" />
                            </MudMenu>
                        </CardHeaderActions>
                    </MudCardHeader>
                    <MudCardContent>
                        <div class="d-flex align-items-start">
                            @if (!string.IsNullOrEmpty(book.ImageLink))
                            {
                                <MudImage Src="@book.ImageLink" Alt="Book cover" Class="book-image mr-3" />
                            }
                            <div class="flex-grow-1">
                                <div class="d-flex">
                                    <MudText Class="ml-2" Typo="Typo.body2"><strong>ISBN: </strong></MudText>
                                    <MudText Class="ml-2" Typo="Typo.body2">@book.ISBN</MudText>
                                </div>
                                <div class="d-flex">
                                    <MudText Class="ml-2" Typo="Typo.body2"><strong>Volume: </strong></MudText>
                                    <MudText Class="ml-2" Typo="Typo.body2">@book.VolumeNumber</MudText>
                                </div>
                                @if (book.ReadingDates.Any())
                                {
                                    <div class="d-flex">
                                        <MudText Class="ml-2" Typo="Typo.body2"><strong>Last read: </strong></MudText>
                                        <MudText Class="ml-2" Typo="Typo.body2">@book.ReadingDates.OrderByDescending(rd => rd.Date).First().Date.ToString("d")</MudText>
                                    </div>
                                }
                            </div>
                        </div>
                    </MudCardContent>
                </MudCard>
            </MudItem>
        }
    </MudGrid>
    
</PageWithAction>
